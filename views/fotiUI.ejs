<html lang="en">

<head>
    <title>FOTI_WEB GIS NV</title>
    <!--Libraries for -->
    <%- include('partials/header.ejs') %>
    <link rel="stylesheet" type="text/css" href="../public/css/fotiStyle.css">
    
</head>

<body>
    <!--Metadata-->
    <p>Showing Images <%= myData.startIndex %> to <%= myData.endIndex %> of <%= myData.totalNumberOfImages %></p>    
    <!--Slider Div-->
    <div id="myCarousel" class="carousel" data-ride="carousel slide" data-interval="false" width="500px">

        <div class="carousel-inner">

            <% myData.listOfImages.forEach(function(image, index) { %>
                <div class="carousel-item  <% if(index == 0) { %> active <% } %>  data-slide-number=<%= index %>">
                    <p>
                        <%= image %> , <%= (index) + myData.startIndex %>
                    </p>
                    <img class="d-block w-100" src="/<%= image %>" alt="First slide">
                </div>
            <% }) %>
                    <!-- Image Navigator.-->
                    <ul class="carousel-indicators list-inline mx-auto border px-2">
                        <% myData.listOfImages.forEach(function(imageName, index) { %>
                            <li class="list-inline-item ">

                                <a class="mine" id="carousel-selector-<%=  index %>"
                                    onclick="changeImage(`<%= index %>`)" class="selected" data-slide-to="<%=  index %>"
                                    data-target="#myCarousel">
                                    <img src="/<%= imageName %>" class="img-fluid">
                                </a>
                            </li>
                            <% }) %>
                    </ul>

                    <% myData.onlyImagesName.forEach(function(imageName, index) { %>
                        <div hidden u="caption" id="index_<%=index + 1%>" fname="<%=imageName%>"
                            prev-slides="<%= myData.MorePrevious%>" more-slides="<%= myData.moreToGet%>"
                            style="position: absolute; top: 25px; left: 5px; background-color: #ffffff">
                            08_20200106_05235.jpg(5236)</div>
        </div>
        <% }) %>

            <!-- Carasoul Next & Prev buttons -->
            <%- include('partials/navigationControls.ejs') %>

    </div>

    <script>
        //Slider controls
        var currentImage = $(this).attr('data-slide-to');
        currentImage = $('div.carousel-item').index() + 1;
        var imagesTotal = $('.carousel-item').length;

        //Previous image control
        $('a.carousel-control-prev').click(function () {
            currentImage -= $('div.carousel-item').index() + 1;
            if (currentImage == 1) {
                var currentSlide = document.getElementById('index_1');
                anAttr = 'prev-slides';

                if (currentSlide.getAttribute(anAttr) == 'true') {
                    var fName = currentSlide.getAttribute('fname');
                    var currentURL = decodeURIComponent((window.location.href + '').replace(/\+/g, '%20'));
                    var newURL = currentURL.slice(0, currentURL.lastIndexOf('\\') + 1) + fName;
                    window.location.assign(newURL);
                }
            }

            console.log("prev", currentImage);
        });

        //Next image control
        $('a.carousel-control-next').click(function () {
            currentImage += $('div.carousel-item').index() + 1;
            if (currentImage == imagesTotal) {
                var currentSlide = document.getElementById('index_' + currentImage);
                console.log("currentslide", currentSlide);
                anAttr = 'more-slides';

                if (currentSlide.getAttribute(anAttr) == 'true') {
                    var fName = currentSlide.getAttribute('fname');
                    var currentURL = decodeURIComponent((window.location.href + '').replace(/\+/g, '%20'));
                    var newURL = currentURL.slice(0, currentURL.lastIndexOf('\\') + 1) + fName;
                    window.location.assign(newURL);
                }
            }

            console.log("next", currentImage)
        });

        //Images selected randomly
        function changeImage(imageNumber) {
            
            var image = parseInt(imageNumber) + 1;
            currentImage = image;
            
            console.log("selected", currentImage);
        }
    </script>